<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="GENERATOR" content="JustSystems Homepage Builder Version 18.0.3.0 for Windows">
<link rel="stylesheet" href="stylesheets/zen_main_danka.css" type="text/css" id="zen_main_danka_detail">
<link rel="stylesheet" href="stylesheets/danka_detail/danka_detail_common.css" type="text/css" id="danka_detail_common">
<link rel="stylesheet" href="stylesheets/danka_detail/danka_detail_kihon.css" type="text/css" id="danka_detail_kihon">
<title>檀家管理システム　禅</title>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/util.js"></script>
<script src="js/dankaInfo.js"></script>
<%
    var memberId = webItemJson.member_id;
    var dankaTypeDanka = webItemJson.danka_type_danka;
    var dankaTypeShinto = webItemJson.danka_type_shinto;
    var nameSei = webItemJson.name_sei;
    var nameNa = webItemJson.name_na;
    var nameFull = webItemJson.name_full;
    var tikuName = webItemJson.tiku_name;
    var sewaName = webItemJson.sewa_name;
    var furiganaSei = webItemJson.furigana_sei;
    var furiganaNa = webItemJson.furigana_na;
    var dankaType = webItemJson.danka_type;
    var sex = webItemJson.sex;
    var jobCode = webItemJson.job_code;
    var tikuCode = webItemJson.tiku_code;
    var sewaCode = webItemJson.sewa_code;
    var birthdayY = webItemJson.birthday_y;
    var birthdayM = webItemJson.birthday_m;
    var birthdayD = webItemJson.birthday_d;
    var memberIdSou = webItemJson.member_id_sou;
    var comment = webItemJson.comment;
%>
<%
    var memberIdKako = dankaInfo[0].member_id;  
    var nameSeiKako = dankaInfo[0].name_sei;
    var nameNaKako = dankaInfo[0].name_na;
    var furiganaSeiKako = dankaInfo[0].furigana_sei;
    var furiganaNaKako = dankaInfo[0].furigana_na;
    var kaimyoKako = dankaInfo[0].kaimyo;
    var sexKako = dankaInfo[0].sex;
    var birthdayYKako = dankaInfo[0].birthday_y;
    var birthdayMKako = dankaInfo[0].birthday_m;
    var birthdayDKako = dankaInfo[0].birthday_d;
    var meinichiYKako = dankaInfo[0].meinichi_y;
    var meinichiMKako = dankaInfo[0].meinichi_m;
    var meinichiDKako = dankaInfo[0].meinichi_d;
    var tikuCodeKako = dankaInfo[0].tiku_code;
    var sewaCodeKako = dankaInfo[0].sewa_code;
    var commentKako = commentInfo[0].comment;
    var tikuNameKako = dankaInfo[0].tiku_name;
    var sewaNameKako = dankaInfo[0].sewa_name;
%>
<script>
 $(function(){

    // ページ遷移定義
    $(".menu_sub_kihon").click(function () {
        $("#danka_detail_kihon_form").submit();
    });
    $(".menu_sub_kako").click(function () {
        $("#danka_detail_kako_form").submit();
    });
    $(".menu_sub_genzai").click(function () {
        $("#danka_detail_genzai_form").submit();
    });
    $(".menu_sub_nenkaiki").click(function () {
        $("#danka_detail_nenkaiki_form").submit();
    });
    $(".menu_sub_kihu").click(function () {
        $("#danka_detail_kihu_form").submit();
    });
    $(".menu_sub_omairi").click(function () {
        $("#danka_detail_omairi_form").submit();
    });

    // 基本情報の初期化
    $("#tiku_list").val(<%= tikuCodeKako %>);
    $("#sewa_list").val(<%= sewaCodeKako %>);

    // 更新時のバリデーションチェック
    $("form").submit(function(){
        // エラーの初期化
        $("p.error").remove();
        $("td").removeClass("error");
        
        // エラーチェック
        $("input[type='text'].validate").each(function(){
            // 必須項目チェック
            if($(this).hasClass("require")){
                if($(this).val() == ""){
                    $(this).parent().append("<p class='error'>値が設定されていません。</p>");
                    $(this).parent().addClass("error");
                }
            } 
            // 数字項目チェック
            if($(this).hasClass("number")){
                if(isNaN($(this).val())){
                    $(this).parent().append("<p>数値が設定されていません。</p>");
                    $(this).parent().addClass("error");
                }
            }            
        });

        // エラーチェック
        if($("p.error").length > 0){
            return false;
        }

        // テキスト項目の差分チェックを実施
        var isChange = false;
        $(".chenge_check").each(function(){
            var key = $(this).attr("name");
            var value = $(this).val();
            $(".chenge_check_bk").each(function(){
                if($(this).hasClass(key)){
                    var valueBk = $(this).val();
                    if(value !== valueBk){
                        isChange = true;
                        return false;
                    }
                    return true;
                }
            });
            
            if(isChange){
                return true;
            }
        });
        
        // select項目の差分比較
        var tikuCodeAfter = $("select[name='tiku_code'] option:selected").val();
        var sewaCodeAfter = $("select[name='sewa_code'] option:selected").val();
        var tikuCodeBk = $("input[name='tiku_code_kako_bk']").val();
        var sewaCodeBk = $("input[name='sewa_code_kako_bk']").val();

        if(tikuCodeAfter !== tikuCodeBk || sewaCodeAfter !== sewaCodeBk){
            isChange = true;
        }

        // radio項目の差分比較
        var sexAfter = $("input[name='sex']:checked").val();
        var sexBk = $("input[name='sex_kako_bk']").val();

        if(sexAfter !== sexBk){
            isChange = true;
        }
        
        // テキストエリアの差分比較
        var commentAfter = $("textarea[name='comment']").val();
        var commentBk = $("input[name='comment_kako_bk']").val();

        if(commentAfter !== commentBk){
            isChange = true;
        }
        // 値が何も変更されていない場合は、ポップアップを出力する。
        if(!isChange){
            alert("変更されていません。");
            return false;
        }
        // 変更有無チェック
        var tikuNameAfter = $("select[name='tiku_code'] option:selected").text();
        var sewaNameAfter = $("select[name='sewa_code'] option:selected").text();
        $("input[name='tiku_name_kako']").val(tikuNameAfter);
        $("input[name='sewa_name_kako']").val(sewaNameAfter);
    });
});
</script>
</head>
<body>
<!-- container -->
<div id="container">
  <!-- header -->
  <div id="header">
    <div id="headerMain">
      <h1>長伝寺様向けカスタマイズ</h1>
    </div>
    <div id="headerLogo">
      <img src="img/logo1_dannkasystem.gif" alt="logo1_dannkasystem">
    </div>
  </div>
  <!-- header end -->
  <!-- inner -->
  <div id="inner">
    <!-- menu_box -->
    <div id="menu_box">
      <div id="temple_img"><img src="img/tyo-denji.jpg" alt="temple-image" width="198" height="132" border=0></div>
      <!-- menu -->
      <div id="menu">
        <nav>
          <ul>
            <li><a href="/schedule_top"><span class="ja">スケジュール</span><span class="en">schedule</span></a>
          </ul>
          <ul>
            <li><a href="/danka_top"><span class="ja">檀家管理</span><span class="en">danke-manage</span></a>  
            <li><a href="/dummy"><span class="ja">僧・世話人管理</span><span class="en">so-manage</span></a>
            <li><a href="/dummy"><span class="ja">台帳管理</span><span class="en">master</span></a>
            <li><a href="/tyohyo_main"><span class="ja">帳票出力</span><span class="en">out-tyohyo</span></a>
          </ul>
          <ul>
            <li><a href="/dummy"><span class="ja">備品管理</span><span class="en">stock-manage</span></a> 
            <li><a href="/index_a"><span class="ja">寺院情報</span><span class="en">user-info</span></a>   
          </ul>
        </nav>
      </div>
      <!-- menu end -->
    </div>
    <!-- menu_box end -->
    <!-- wrapper -->
    <div id="wrapper">
      <!-- inner_title -->
      <div class="inner_title">
        <div class="title">
   	      <h2><span class="ja">檀家管理詳細</span><span class="en">danka detail infomation</span></h2>
        </div>
        <div class="kosyu_info">
   	      <table>
              <thead>
                <tr>
                  <th class="kosyu_info_kosyu_th">戸主名</th>
                  <th class="kosyu_info_type_danka_th">檀家</th>
                  <th class="kosyu_info_type_shinto_th">信徒</th>
                  <th class="kosyu_info_tiku_th">地区</th>
                  <th class="kosyu_info_sewa_th">世話人</th>
                </tr>
              </thead>
              <tbody>
                <tr id="<%= memberId %>">
                  <td class="table_name_full"><%= nameFull %></td>
                  <td class="table_danka_type_danka"><%= dankaTypeDanka %></td>
                  <td class="table_danka_type_shinto"><%= dankaTypeShinto %></td>
                  <td id="<%= tikuCode %>" class="table_tiku_name"><%= tikuName %></td>
                  <td id="<%= sewaCode %>" class="table_sewa_name"><%= sewaName %></td>
                </tr>
              </tbody>
            </table>
        </div>
        <div class="menu_sub">
          <ul>
            <li class="menu_sub_kihon">基本情報 
            <li class="menu_sub_kako">過去帳
            <li class="menu_sub_nenkaiki">年回忌
            <li class="menu_sub_kihu">寄付帳
            <li class="menu_sub_omairi">お参り帳
          </ul>
        </div>
      </div>
      <!-- title end-->
      <!-- inner_main □□□□□□□□□□□□□□□□□□□□□□□□□□□□□□□□ -->
      <div class="inner_main">
        <form action="danka_detail_kako_confirm" method="post">
          <div class="table_main_kihon">
            <table>
              <thead>
                <tr class="table_main_kihon_header">
                  <th class="table_main_kihon_header_komoku">登録項目</td>
                  <th class="table_main_kihon_header_naiyo">登録内容</td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td id="name_type">俗名(※必須)</td>
                  <td id="name" class="table_main_tuika_selectable">
                      <label for="name_seimei">姓: </label><input type="text" name="name_sei_kako" class="chenge_check validate require duplicate_pre" value="<%= nameSeiKako %>">
                      <label for="name_seimei">名: </label><input type="text" name="name_na_kako" class="chenge_check validate require duplicate_end" value="<%= nameNaKako %>">
                  </td>
                </tr>
                <tr>
                  <td id="furigana_type">ふりがな(※必須)</td>
                  <td id="furigana" class="table_main_tuika_selectable">
                      <label for="furi_seimei">せい: </label><input type="text" name="furigana_sei_kako" class="chenge_check validate require duplicate_pre" value="<%= furiganaSeiKako %>">
                      <label for="furi_namae">めい: </label><input type="text" name="furigana_na_kako" class="chenge_check validate require duplicate_end" value="<%= furiganaNaKako %>">
                  </td>
                </tr>
                <tr>
                  <td id="kaimyo_type">戒名</td>
                  <td id="furigana" class="table_main_tuika_selectable">
                    <input type="text" name="kaimyo_kako" class="chenge_check validate require duplicate_end" value="<%= kaimyoKako %>">
                  </td>
                </tr>
                <tr>
                  <td id="sex_type">性別(※必須)</td>
                  <td id="sex" class="table_main_tuika_selectable">
                      <%
                      if(sexKako == "1"){
                      %>
                        <input type="radio" name="sex_kako" class="dummay" value="1" checked><label for="man">男</label>
                        <input type="radio" name="sex_kako" class="dummay" value="2"><label for="woman">女</label>                
                      <%
                      }else{
                      %>
                        <input type="radio" name="sex_kako" class="dummay" value="1"><label for="man">男</label>
                        <input type="radio" name="sex_kako" class="dummay" value="2" checked><label for="woman">女</label>                 
                      <%
                      }
                      %>
                  </td>
                </tr>
                <tr>
                  <td id="birthday_type">生年月日</td>
                  <td id="birthday" class="table_main_tuika_selectable">
                       <input type="text" name="birthday_y_kako" class="chenge_check validate number telno_size" value="<%= birthdayYKako %>">
                       年 <input type="text" name="birthday_m_kako" class="chenge_check validate number telno_size" value="<%= birthdayMKako %>">
                       月 <input type="text" name="birthday_d_kako" class="chenge_check validate number telno_size" value="<%= birthdayDKako %>">
                       日
                  </td>
                </tr>
                <tr>
                  <td id="meinichi_type">命日</td>
                  <td id="meinichi" class="table_main_tuika_selectable">
                       <input type="text" name="meinichi_y_kako" class="chenge_check validate number telno_size" value="<%= meinichiYKako %>">
                       年 <input type="text" name="meinichi_m_kako" class="chenge_check validate number telno_size" value="<%= meinichiMKako %>">
                       月 <input type="text" name="meinichi_d_kako" class="chenge_check validate number telno_size" value="<%= meinichiDKako %>">
                       日
                  </td>
                </tr>
                <tr>
                  <td id="kyonen_type">享年</td>
                  <td id="kyonen" class="table_main_tuika_selectable">
                      <script>
                          calculateAge("<%= birthdayYKako %>", "<%= birthdayMKako %>", "<%= birthdayDKako %>", "<%= meinichiYKako %>", "<%= meinichiMKako %>", "<%= meinichiDKako %>");
                      </script>
                      ※生年月日と命日から自動算出しています。
                  </td>
                </tr>
                <tr>
                  <td id="tiku_type">地区</td>
                  <td id="tiku" class="table_main_tuika_selectable">
                     <select id="tiku_list" name="tiku_code_kako" >
                      <% for(var i in tikuCodeInfo){
                        var _tikuCode = tikuCodeInfo[i].tiku_code;
                        var _tikuName = tikuCodeInfo[i].tiku_name; %>
                         <option value=<%= _tikuCode %>><%= _tikuName %></option>
                         <%}%>
                     </select>
                  </td>
                </tr>
                <tr>
                  <td id="sewa_type">世話人</td>
                  <td id="sewa" class="table_main_tuika_selectable">
                     <select id="sewa_list" name="sewa_code_kako" >
                      <% for(var i in sewaCodeInfo){
                        var _sewaCode = sewaCodeInfo[i].sewa_code;
                        var _sewaName = sewaCodeInfo[i].sewa_name; %>
                         <option value=<%= _sewaCode %>><%= _sewaName %></option>
                         <%}%>
                     </select>
                  </td>
                </tr>
                <tr>
                  <td id="furigana_type">戸主名(※必須)</td>
                  <td id="furigana" class="table_main_tuika_selectable">
                      <label for="kosyu"><%= nameFull %></label>
                  </td>
                </tr>
                <tr>
                  <td class="comment_type">備考<br>※500文字以内</td>
                  <td class="comment table_main_tuika_selectable">
                     <textarea name="comment_kako" class="textarea_size"><%= commentKako %></textarea>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- サマリ画面表示情報 -->
          <input type="hidden" name="member_id" value="<%= memberId %>">
          <input type="hidden" name="danka_type_danka" value="<%= dankaTypeDanka %>">
          <input type="hidden" name="danka_type_shinto" value="<%= dankaTypeShinto %>">
          <input type="hidden" name="name_full" value="<%= nameFull %>">
          <input type="hidden" name="tiku_name" value="<%= tikuName %>">
          <input type="hidden" name="sewa_name" value="<%= sewaName %>">
          <input type="hidden" name="tiku_code" value="<%= tikuCode %>">
          <input type="hidden" name="sewa_code" value="<%= sewaCode %>">
          <!-- 基本情報画面遷移の為の情報 -->
          <input type="hidden" name="name_sei" value=<%= nameSei %>>
          <input type="hidden" name="name_na" value=<%= nameNa %>>
          <input type="hidden" name="furigana_sei" value=<%= furiganaSei %>>
          <input type="hidden" name="furigana_na" value=<%= furiganaNa %>>
          <input type="hidden" name="danka_type" value=<%= dankaType %>>
          <input type="hidden" name="sex" value=<%= sex %>>
          <input type="hidden" name="job_code" value=<%= jobCode %>>
          <input type="hidden" name="birthday_y" value=<%= birthdayY %>>
          <input type="hidden" name="birthday_m" value=<%= birthdayM %>>
          <input type="hidden" name="birthday_d" value=<%= birthdayD %>>
          <input type="hidden" name="member_id_sou" value=<%= memberIdSou %>>
          <!-- 変更前を保存 -->
          <input type="hidden" name="member_id_kako" value="<%= memberIdKako %>">
          <input type="hidden" name="name_sei_kako_bk" class="chenge_check_bk name_sei" value="<%= nameSeiKako %>">
          <input type="hidden" name="name_na_kako_bk" class="chenge_check_bk name_na" value="<%= nameNaKako %>">
          <input type="hidden" name="furigana_sei_kako_bk" class="chenge_check_bk furigana_sei" value="<%= furiganaSeiKako %>">
          <input type="hidden" name="furigana_na_kako_bk" class="chenge_check_bk furigana_na" value="<%= furiganaNaKako %>">
          <input type="hidden" name="sex_kako_bk" class="sex" value="<%= sexKako %>">
          <input type="hidden" name="kaimyo_kako_bk" class="chenge_check_bk kaimyo" value="<%= kaimyoKako %>">
          <input type="hidden" name="birthday_y_kako_bk" class="chenge_check_bk birthday_y" value="<%= birthdayYKako %>">
          <input type="hidden" name="birthday_m_kako_bk" class="chenge_check_bk birthday_m" value="<%= birthdayMKako %>">
          <input type="hidden" name="birthday_d_kako_bk" class="chenge_check_bk birthday_d" value="<%= birthdayDKako %>">
          <input type="hidden" name="meinichi_y_kako_bk" class="chenge_check_bk meinichi_y" value="<%= meinichiYKako %>">
          <input type="hidden" name="meinichi_m_kako_bk" class="chenge_check_bk meinichi_m" value="<%= meinichiMKako %>">
          <input type="hidden" name="meinichi_d_kako_bk" class="chenge_check_bk meinichi_d" value="<%= meinichiDKako %>">
          <input type="hidden" name="tiku_code_kako_bk" value="<%= tikuCodeKako %>">
          <input type="hidden" name="sewa_code_kako_bk" value="<%= sewaCodeKako %>">
          <input type="hidden" name="tiku_name_kako_bk" value="<%= tikuNameKako %>">
          <input type="hidden" name="sewa_name_kako_bk" value="<%= sewaNameKako %>">
          <input type="hidden" name="tiku_name_kako" value="dummy">
          <input type="hidden" name="sewa_name_kako" value="dummy">
          <input type="hidden" name="comment_kako_bk" value="<%= commentKako %>">
          <div id="new_submit"><input type="submit" value="内容変更確認" id="submit"></div>
        </form>
      </div>
      <!-- inner_main end □□□□□□□□□□□□□□□□□□□□□□□□□□□□□ -->
    </div>
    <!-- wrapper end -->
  </div>
  <!-- inner end -->
  <!-- footer -->
  <div id="footer">
    <div id="footer_main">
      <p>copyright&copy;2014&nbsp;SunForest&nbsp;rights&nbsp;reserved.</p>
    </div>
  <!-- footer end -->
</div>
<!-- container end -->
</div>
</body>
</html>